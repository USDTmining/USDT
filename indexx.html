<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>USDT Mining - Register & Login</title>
  <link rel="icon" href="usdt.png">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #041024, #0b132b);
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 90%;
      max-width: 400px;
      margin: 50px auto;
      background: #091733;
      border-radius: 20px;
      padding: 30px 20px;
      box-shadow: 0 0 25px rgba(0,255,255,0.1);
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
      color: #0ef;
    }
    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: #11214a;
      color: #fff;
      outline: none;
      margin-bottom: 15px;
      font-size: 0.9em;
    }
    button {
      width: 100%;
      background: #0ef;
      color: #000;
      font-weight: bold;
      border: none;
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1em;
      transition: 0.3s;
    }
    button:hover {
      background: #09c9c9;
      transform: scale(1.02);
    }
    .toggle-link {
      margin-top: 10px;
      font-size: 0.85em;
      color: #b6ccff;
      cursor: pointer;
      text-decoration: underline;
    }
    label {
      display: flex;
      align-items: center;
      font-size: 0.8em;
      margin-top: 10px;
      color: #b6ccff;
    }
    input[type="checkbox"] {
      width: auto;
      margin-right: 6px;
    }

    /* Popup Styles */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .popup-content {
      background: #0a1b3d;
      border-radius: 15px;
      padding: 20px;
      width: 85%;
      max-width: 400px;
      box-shadow: 0 0 25px rgba(0,255,255,0.2);
      text-align: left;
      color: #bde3ff;
      font-size: 0.9em;
      line-height: 1.5;
    }
    .popup-content h3 {
      color: #0ef;
      text-align: center;
      margin-bottom: 10px;
    }
    .close-popup {
      display: block;
      margin: 15px auto 0;
      text-align: center;
      background: #0ef;
      color: #000;
      padding: 8px 20px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      width: fit-content;
      transition: 0.3s;
    }
    .close-popup:hover {
      background: #09c9c9;
      transform: scale(1.05);
    }
  </style>
</head>
<body>

  <!-- Registration Form -->
  <div class="container" id="registerContainer">
    <h2>Create Account</h2>
    <input type="text" id="regUsername" placeholder="Username" required>
    <input type="email" id="regEmail" placeholder="Email" required>
    <input type="password" id="regPassword" placeholder="Password" required>

    <label>
      <input type="checkbox" id="termsCheck">
      I agree to the <span id="showTerms" style="color:#0ef;cursor:pointer;">Terms & Conditions</span>
    </label>

    <button id="registerBtn">Register</button>
    <div class="toggle-link" id="showLogin">Already have an account? Login here</div>
  </div>

  <!-- Login Form -->
  <div class="container" id="loginContainer" style="display:none;">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button id="loginBtn">Login</button>
    <div class="toggle-link" id="showRegister">Donâ€™t have an account yet? Register</div>
  </div>

  <!-- Terms & Conditions Popup -->
  <div class="popup" id="termsPopup">
    <div class="popup-content">
      <h3>Terms & Conditions</h3>
      <p>
        Welcome to USDT Miner. By creating an account, you agree to the following:
      </p>
      <ul>
        <li>All users must provide accurate registration details.</li>
        <li>You will earn $0.3 for each valid referral and $0.3 for being referred.</li>
        <li>Withdrawals are only available to verified users meeting rank requirements.</li>
        <li>Accounts engaging in fraudulent referrals will be permanently suspended.</li>
        <li>We reserve the right to update or change these terms at any time.</li>
      </ul>
      <div class="close-popup" id="closePopup">Close</div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // ðŸ”¥ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDpKqM5-Xr9cM8G12Zx2e2kzEqFZsDg8jA",
      authDomain: "usdt-mining.firebaseapp.com",
      databaseURL: "https://usdt-mining-default-rtdb.firebaseio.com",
      projectId: "usdt-mining",
      storageBucket: "usdt-mining.appspot.com",
      messagingSenderId: "675394582437",
      appId: "1:675394582437:web:8d8fbd8c14257e39e5f912"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Elements
    const registerContainer = document.getElementById("registerContainer");
    const loginContainer = document.getElementById("loginContainer");
    const showLogin = document.getElementById("showLogin");
    const showRegister = document.getElementById("showRegister");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const termsPopup = document.getElementById("termsPopup");
    const showTerms = document.getElementById("showTerms");
    const closePopup = document.getElementById("closePopup");

    // Toggle Login/Register
    showLogin.onclick = () => {
      registerContainer.style.display = "none";
      loginContainer.style.display = "block";
    };
    showRegister.onclick = () => {
      loginContainer.style.display = "none";
      registerContainer.style.display = "block";
    };

    // Show Terms Popup
    showTerms.onclick = () => termsPopup.style.display = "flex";
    closePopup.onclick = () => termsPopup.style.display = "none";

    // Detect ?ref=
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get("ref");

    // Registration
    registerBtn.onclick = async () => {
      const username = document.getElementById("regUsername").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const password = document.getElementById("regPassword").value.trim();
      const terms = document.getElementById("termsCheck").checked;

      if (!username || !email || !password) return alert("Please fill in all fields.");
      if (!terms) return alert("You must agree to the Terms & Conditions before registering.");

      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, "users"));
      const users = snapshot.exists() ? snapshot.val() : {};

      const emailExists = Object.values(users).some(u => u.email === email);
      if (emailExists) return alert("Email already exists.");

      const referralCode = Math.random().toString(36).substring(2, 8).toUpperCase();
      const newUserId = Date.now().toString();
      const userPosition = 834597 + Object.keys(users).length;

      let userData = {
        username,
        email,
        password,
        referralCode,
        referralCount: 0,
        referralEarnings: 0,
        position: userPosition,
        balance: 0
      };

      // Handle referral bonus
      if (refCode) {
        const inviterId = Object.keys(users).find(id => users[id].referralCode === refCode);
        if (inviterId) {
          const inviter = users[inviterId];
          const inviterRef = ref(db, "users/" + inviterId);
          await update(inviterRef, {
            referralCount: (inviter.referralCount || 0) + 1,
            referralEarnings: (inviter.referralEarnings || 0) + 0.3,
            balance: (inviter.balance || 0) + 0.3
          });
          userData.balance = 0.3;
        }
      }

      await set(ref(db, "users/" + newUserId), userData);

      alert("Registration successful! Please login.");
      registerContainer.style.display = "none";
      loginContainer.style.display = "block";
    };

    // Login
    loginBtn.onclick = async () => {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();
      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, "users"));
      if (!snapshot.exists()) return alert("No users found.");

      const users = snapshot.val();
      const user = Object.values(users).find(u => u.email === email && u.password === password);
      if (!user) return alert("Invalid credentials.");

      localStorage.setItem("email", email);
      alert("Login successful!");
      window.location.href = "mine.html";
    };
  </script>
</body>
</html>
