<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USDT Miner - Register / Login</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0c162d">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }
    body {
      background: linear-gradient(145deg, #0b1429, #111d3d);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #fff;
      overflow: hidden;
    }

    .container {
      width: 90%;
      max-width: 400px;
      background: #0e1a33;
      border-radius: 20px;
      box-shadow: 8px 8px 15px #080f1f, -8px -8px 15px #18294f;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .header {
      font-size: 1.8em;
      font-weight: 600;
      color: #00ffd5;
      text-shadow: 0 0 10px rgba(0,255,213,0.5);
      margin-bottom: 20px;
    }

    .tab-buttons {
      display: flex;
      justify-content: space-around;
      margin-bottom: 25px;
    }

    .tab-buttons button {
      flex: 1;
      padding: 10px;
      background: #0e1a33;
      border: none;
      color: #ccc;
      font-size: 1em;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: inset 4px 4px 8px #080f1f, inset -4px -4px 8px #18294f;
      transition: 0.3s;
    }

    .tab-buttons button.active {
      background: #00ffd5;
      color: #0b1429;
      font-weight: 600;
      box-shadow: 0 0 10px #00ffd5, inset 2px 2px 5px rgba(255,255,255,0.2);
    }

    form {
      display: none;
      flex-direction: column;
      gap: 15px;
    }

    form.active {
      display: flex;
    }

    input {
      padding: 12px;
      border: none;
      outline: none;
      border-radius: 12px;
      background: #0b1429;
      color: #fff;
      box-shadow: inset 3px 3px 6px #080f1f, inset -3px -3px 6px #18294f;
    }

    button.submit {
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: #00ffd5;
      color: #0b1429;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    button.submit:hover {
      background: #02cfa8;
    }

    .terms {
      font-size: 0.9em;
      color: #ccc;
      text-align: left;
      margin-top: -8px;
    }
    .terms input {
      width: auto;
      margin-right: 5px;
      accent-color: #00ffd5;
    }
    .terms a {
      color: #00ffd5;
      cursor: pointer;
      text-decoration: underline;
    }

    /* Terms popup */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
    }

    .popup-content {
      background: #0e1a33;
      color: #fff;
      width: 85%;
      max-width: 400px;
      border-radius: 15px;
      padding: 25px;
      text-align: left;
      box-shadow: 0 0 15px rgba(0,255,213,0.4);
      position: relative;
    }

    .popup-content h2 {
      color: #00ffd5;
      margin-bottom: 10px;
    }

    .popup-content p {
      font-size: 0.9em;
      line-height: 1.5em;
      color: #ccc;
    }

    .close-popup {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      color: #00ffd5;
      font-size: 1.2em;
      cursor: pointer;
    }

    .alert {
      color: #ff5050;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">USDT Miner</div>

    <div class="tab-buttons">
      <button id="registerTab" class="active">Register</button>
      <button id="loginTab">Login</button>
    </div>

    <!-- Registration Form -->
    <form id="registerForm" class="active">
      <input type="text" id="regUsername" placeholder="Username" required>
      <input type="email" id="regEmail" placeholder="Email" required>
      <input type="password" id="regPassword" placeholder="Password" required>
      <div class="terms">
        <label><input type="checkbox" id="agreeTerms"> I agree to the <a id="openTerms">Terms & Conditions</a></label>
      </div>
      <button type="submit" class="submit">Register</button>
      <div id="registerAlert" class="alert"></div>
    </form>

    <!-- Login Form -->
    <form id="loginForm">
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button type="submit" class="submit">Login</button>
      <div id="loginAlert" class="alert"></div>
    </form>
  </div>

  <!-- Terms Popup -->
  <div class="popup" id="termsPopup">
    <div class="popup-content">
      <button class="close-popup" id="closeTerms">&times;</button>
      <h2>Terms & Conditions</h2>
      <p>
        By registering on USDT Miner, you agree to abide by our policies.
        You acknowledge that mining rewards and referral bonuses are subject to verification and compliance with our fair use standards.
        Misuse, fraud, or multiple account creation may lead to suspension.
        Rewards are for active verified users only.
      </p>
      <p>
        Your personal data (email, username) will be stored securely for authentication and referral tracking purposes.
      </p>
      <p>By checking “I agree,” you consent to these terms.</p>
    </div>
  </div>

  <script type="module">
    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, set, get, update, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDk1g-8dLz_4N1Xv9cYvY5mP7g9Z6p0l5W",
      authDomain: "usdt-login.firebaseapp.com",
      databaseURL: "https://usdt-login-default-rtdb.firebaseio.com",
      projectId: "usdt-login",
      storageBucket: "usdt-login.appspot.com",
      messagingSenderId: "1037466394440",
      appId: "1:1037466394440:web:4a5d4a982e1a3a6a6c1bb7"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const registerTab = document.getElementById("registerTab");
    const loginTab = document.getElementById("loginTab");
    const registerForm = document.getElementById("registerForm");
    const loginForm = document.getElementById("loginForm");

    registerTab.onclick = () => {
      registerForm.classList.add("active");
      loginForm.classList.remove("active");
      registerTab.classList.add("active");
      loginTab.classList.remove("active");
    };
    loginTab.onclick = () => {
      registerForm.classList.remove("active");
      loginForm.classList.add("active");
      registerTab.classList.remove("active");
      loginTab.classList.add("active");
    };

    // Terms popup
    const termsPopup = document.getElementById("termsPopup");
    const openTerms = document.getElementById("openTerms");
    const closeTerms = document.getElementById("closeTerms");
    openTerms.onclick = () => termsPopup.style.display = "flex";
    closeTerms.onclick = () => termsPopup.style.display = "none";

    // Registration
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = regUsername.value.trim();
      const email = regEmail.value.trim();
      const password = regPassword.value.trim();
      const agreed = document.getElementById("agreeTerms").checked;
      const alertBox = document.getElementById("registerAlert");

      if (!agreed) {
        alertBox.textContent = "You must agree to the Terms & Conditions.";
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Referral code logic
        const params = new URLSearchParams(window.location.search);
        const refCode = params.get("ref");
        const userRefCode = user.uid.slice(0, 6);

        await set(ref(db, "users/" + user.uid), {
          username: username,
          email: email,
          refCode: userRefCode,
          referredBy: refCode || "",
          referrals: 0,
          referralEarnings: 0.3,
          balance: 0.3,
          rank: 0
        });

        if (refCode) {
          const refSnap = await get(child(ref(db), "users"));
          refSnap.forEach(u => {
            if (u.val().refCode === refCode) {
              update(ref(db, "users/" + u.key), {
                referrals: (u.val().referrals || 0) + 1,
                referralEarnings: (u.val().referralEarnings || 0) + 0.3
              });
            }
          });
        }

        alertBox.style.color = "#00ffd5";
        alertBox.textContent = "Registration successful! Redirecting to login...";
        setTimeout(() => {
          loginTab.click();
        }, 1500);
      } catch (err) {
        alertBox.textContent = err.message;
      }
    });

    // Login
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = loginEmail.value.trim();
      const password = loginPassword.value.trim();
      const alertBox = document.getElementById("loginAlert");
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alertBox.style.color = "#00ffd5";
        alertBox.textContent = "Login successful! Redirecting...";
        setTimeout(() => {
          window.location.href = "mine.html";
        }, 1200);
      } catch (err) {
        alertBox.textContent = "Invalid login credentials.";
      }
    });
  </script>
</body>
</html>
